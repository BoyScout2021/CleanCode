# 형식 맞추기 

## 개요

프로그래머라면 형식을 깔끔하게 맞춰 코드를 짜야 한다.
* 코드 형식을 맞추기 위해 **간단한 규칙**을 정하고 그 규칙을 착실히 따라야 한다.
* 팀으로 일한다면 팀이 합의해 **팀 규칙**을 정하고 팀원 모두가 그 규칙을 따라야 한다.
* 필요하다면 규칙을 자동으로 적용하는 도구를 활용한다(ex. `SwiftLint`).

## 형식을 맞추는 목적

형식을 맞추는 목적 및 이유는 코드 형식이 앞으로의 **코드의 품질에 지대한 영향을 미치기 때문**이다. 오랜 시간이 지나 원래 코드의 흔적을 더 이상 찾아보기 어려울 정도로 코드가 바뀌어도 맨 처음 잡아놓은 구현 스타일과 가독성 수준은 **유지보수 용이성과 확장성에 계속을 영향을 미치기 때문**이다.

이 항목에서 가장 인상깊은 한 마디: 코드 형식은 너무나도 중요하므로 **융통성 없이 맹목적으로 따르면 안된다.** 코드 형식은 **의사소통의 일환**이다.

## 적절한 행 길이를 유지하라

여기 내용에서 설명하는 프로젝트들을 평균 파일 크기는 100줄 ~ 200줄이다. 경이롭다. 특히 FitNesse는 총 50000줄에 육박하는 프로젝트인데 평균 파일 크기가 65줄이다!
<br>=> 내가 멋모르고 1달 다녔던 기업의 코드는 파일당 기본 1만줄이 넘었다. 그것도 iOS 소스 코드였다. 1만줄이 넘는 파일들을 보고 느낀 점은 파일이 너무 커서 보기 어려웠고 파일 자체가 매우 복잡해 보였다. 그리고 위에서 아래로 스크롤해보면 동일한 내용의 코드가 중복된다는 것을 바로 알아차릴 수 있었다. 즉 줄일 수 있는데도 줄이지 않은 것이었다. 반드시 재사용 할 부분은 재사용해서 파일 크기도 줄이자. **일반적으로 큰 파일보다 작은 파일이 이해하기 쉽기 때문이다.**

### 신문 기사처럼 작성하라

* 소스 파일 첫 부분은 고차원 개념과 알고리즘을 설명하자. 
* 아래로 내려갈수록 의도를 세세하게 묘사하자. 
* 마지막에는 가장 저차원 함수와 세부 내역이 나오게 작성하자.

=> 즉 처음에는 추상적으로 고차원의 메서드를 작성하고 파일을 내릴수록 위의 고차원 메서드들을 뒷받침하는 저차원 메서드를 작성하자는 말이다.

### 개념은 빈 행으로 분리하라

패키지, import문, 각 함수 사이에 한 칸씩 빈 행을 넣자.
빈 행을 빼버린 코드는 코드 가독성이 현저하게 떨어져 암호처럼 보인다. 
꼭 빈 행의 중요성을 인지하고 한 칸씩 띄우자. **엄청 중요하다!**

### 세로 밀집도

세로 밀집도(세로로 가까이 있을수록 밀집도가 높다)는 연관성을 의미한다. 즉, 서로 밀접한 코드 행은 세로로 가까이 놓여야 한다는 뜻이다. 

같은 파일에 속할 정도로 밀접한 두 개념은 세로 거리로 연관성을 표현한다. 여기서 연관성이란 한 개념을 이해하는데 다른 개념이 중요한 정도다. **연관성이 깊은 두 개념이 멀리 떨어져 있으면 읽는 사람이 소스 파일과 클래스를 여기저기 뒤지게 된다.**
 
> 변수 선언

* 변수는 사용하는 위치에 **최대한 가까이 선언**한다. 우리가 만드는 함수는 매우 짦으므로 지역 변수는 **각 함수 맨 처음에 선언**한다.

```java
private static void readPreferences() {
    InputStream is = null; // 각 변수는 맨 처음에 선언한다.
    try {
        is = new FileInputStream(getPreferencesFile());
        setPreferences(new Properties(getPreferences()));
        getPreferences().load(is);
    } catch
    // ... 생략 
}
```

* 루프를 제어하는 변수는 흔히 루프 문 내부에 선언한다. 

```java
public int countTestCases() {
    int count = 0;
    for (Tech each: tests) // 루프를 제어하는 변수는 흔히 루프 문 내부에 선언한다. 
        count += each.countTestCases();
    return count;
}
```

> 인스턴스 변수

인스턴스 변수는 클래스 맨 처음에 선언한다. 변수 간에 세로로 거리를 두지 않는다.
**잘 설계한 클래스는 많은 (혹은 대다수) 클래스 메서드가 인스턴스 변수를 사용하기 때문이다.**

> 종속 함수

* 한 함수가 다른 함수를 호출한다면 두 함수는 세로로 가까이 배치한다. 또한 **가능하다면 호출하는 함수(Caller)를 호출되는 함수(Callee)보다 먼저 배치**한다. 그러면 프로그램이 자연스럽게 읽힌다.
* `getPageNameOrDefault` 함수 안에서 "FrontPage" 상수를 사용하는 방법도 있다. 하지만 기대와는 달리 잘 알려진 상수가 적절하지 않은 **저차원 함수에 묻힌다.** 상수를 알아야 마땅한 함수에서 **실제로 사용하는 함수로 상수를 넘겨주는 방법**이 더 좋다.

> 개념적 유사성

친화도가 높을수록 코드를 가까이 배치한다. 직접적인 종속성인 것외에도 친화도를 높이는 요인이 있다. **비슷한 동작을 수행하는 일군의 함수**가 좋은 예다. 

```java
public class Assert {
    static public void assertTrue(String message, boolean condition) {
        if(!condition) {
            fail(message);
        }
    }

    static public void assertTrue(boolean condition) {
        assertTrue(null, condition);
    }

    static public void assertFalse(String message, boolean condition) {
        assertTrue(message, !condition);
    }

    static public void assertFalse(boolean condition) {
        assertFalse(null, condition);
    }
}
```

## 가로 형식 맞추기

프로그래머는 명백하게 짧은 행을 선호한다. 한 행에 100자나 120자에 달해도 나쁘지 않다. 하지만 그 이상은 솔직히 주의부족이다. 따라서 120자를 넘지 않도록 조심하고 짭른 행을 선호하자!

### 가로 공백과 밀집도

```java
totalChars += lineSize;
```
=> 할당 연산자를 강조하려고 앞뒤에 공백을 두자 

```java
lineWidthHistogram.addLine(lineSize, lineCount);
```
=> 함수 이름과 이어지는 괄호 사이에는 공백을 넣지 않는다. 함수와 인수는 서로 밀접하기 때문이다. 공백을 넣으면 한 개념이 아니라 별개로 보이므로 좋지 않다. 함수를 호출하는 코드에서 괄호 안 인수는 공백으로 분리했다. **쉼표를 강조해 인수가 별개라는 사실을 보여주기 위해서다.**

### 가로 정렬

가로 정렬은 하지 말자. 코드의 엉뚱한 부분을 강조해 **진짜 의도가 가려지기 때문이다.**
* 예를 들어, 위 선언부를 읽다 보면 **변수 타입은 무시하고** 변수 이름부터 읽게 된다.
* 마찬가지로, 위 할당문을 훑어보면 **할당 연산자는 보이지 않고** 오른쪽 피연산자에 눈이 가게 된다.

### 들여쓰기

프로그래머는 들여쓰기 체계에 크게 의존한다. 
왼쪽으로 코드를 맞춰 코드가 속하는 범위를 시각적으로 표현한다. 
**그러면 이 범위에서 저 범위로 재빨리 이동하기 쉬워진다.** 
현재 상황과 무관한 if 문/while 문 코드를 일일이 살펴볼 필요가 없다. 
소스 파일 왼쪽을 훑으면서 새 메서드, 새 변수, 새 클래스도 찾는다. 
**들여쓰기가 없다면 인간이 코드를 읽기란 불가능하다.**

### 가짜 범위

빈 while 문이나 for문을 피한다. 피하지 못한다면 세미콜론(;)을 새 행에다 제대로 들여써서 넣어준다. 

* before 
```java
while(dis.read(buf, 0, readBufferSize) != 1);
```
=> 이런 식으로 코드가 들어가면 while 문 아래의 코드들이 while문에 적용된 코드인 줄 아는 오해 및 착각을 불러 일으킨다. 

* after
```java
while(dis.read(buf, 0, readBufferSize) != 1)
;
```
=> 이렇게 새 행에다 세미콜론을 들여써야 빈 for문이나 while문인지 독자가 알아챈다! 

## 팀 규칙

* 팀은 한 가지 규칙에 합의해야 한다. 그리고 모든 팀원은 그 규칙을 따라야 한다. 그래야 소프트웨어가 일관적인 스타일을 보인다. **개개인이 따로국밥처럼 만대로 짜대는 코드는 피해야 한다**(코딩 표준을 지켜야 한다). 
* 내가 선호하는 규칙이 아니어도 **팀이 정한 규칙이라면 팀 규칙대로 코드를 짜야 한다. 당연하다.**
