# 단위 테스트

테스트 코드 잘 짜고 싶다..!

## TDD 법칙 세 가지

1. 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
2. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
3. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

<br>

## 깨끗한 테스트 코드 유지하기

테스트 코드를 깔끔하게 작성하지 못하면 테스트 케이스를 유지하고 보수하는 비용 또한 늘어나게 된다.
그렇다고 테스트 코드를 작성하지 않으면 자신이 수정한 코드가 제대로 돌아가는지 확인할 방법이 없다.

테스트 코드를 깔끔하게 작성하지 못함 -> 테스트 케이스를 유지하고 보수하는 비용이 증가한다.

그렇다고 테스트 코드를 작성하지 않으면? <br>
-> 수정한 코드가 제대로 동작하는지 확인할 방법이 없다. <br>
-> 결함율이 높아진다. 😇 <br>
-> 변경을 주저하게 된다. <br>
-> 코드를 정리하지 않게 된다. <br>
-> 코드가 망가지기 시작한다.

결론 : 테스트 코드 또한 실제 코드 못지 않게 작성해야 한다.

### 테스트는 유연성, 유지보수성, 재사용성을 제공한다.
테스트 케이스가 있으면 **변경**이 쉬워진다.

<br>

## 깨끗한 테스트 코드
가독성이 중요하다. 실제 코드보다 더!

### 도메인에 특화된 테스트 언어
시스템 조작 API를 사용하는 대신 API 위에다 함수와 유틸리티를 구현한 후(랩핑) 그것들을 사용하므로 테스트 코드를 작성하기도 읽기도 쉬워진다. <br>
=> 테스트 **언어**

### 이중 표준
테스트 API코드에 적용하는 표준은 실제 코드에 적용하는 표준과 확실히 **다르다**. <br>
=> 실제 환경이 아니라 테스트 환경에서 돌아가는 코드이기 때문.

그럴순 있는데 이게 코드의 깨끗하게 작성하는 거랑은 별개의 문제이니까 깨끗하게 작성할 수 있도록 하자.

<br>

## 테스트 당 assert 하나
결론이 하나라서 코드를 이해하기 쉽고 빠르다.

테스트를 분리하면 중복되는 코드가 많아질 수도 있다.
=> Template Method 패턴으로 해결이 가능
[Template Method Swift 예시](https://refactoring.guru/design-patterns/template-method/swift/example) : 책에서는 상속으로 설명했는데 protocol로도 충분히 가능할듯.

근데 해당 방식을 사용하는 경우도 배보다 배꼽이 더 클수도 있으므로 상황에 따라 assert문이 2개 이상인 경우도 고려해야 한다.

### 테스트 당 개념 하나
함수는 한 가지 일만 하는 것을 권장하는 것과 비슷하다고 느껴졌습니다.

assert문은 여러개 일 순 있는데, 한 테스트에서는 하나의 개념만을 테스트 해야한다.

<br>

## F.I.R.S.T
깨끗한 테스트 코드를 작성하기 위한 5가지 규칙
(Fast, Independent, Repeatable, Self-Validating, Timely)

- **F (빠르게)**
테스트는 빨리 돌아야 한다. (자주 돌려야하기 때문)
- **I (독립적으로)**
각 테스트는 서로 의존하면 안 된다. 어떤 순서로 실행해도 괜찮아야 한다.
(싱글톤을 지양합시다..)
- **R (반복가능하게)**
테스트는 어떤 환경에서도 반복 가능해야 한다.
(네트워크에 연결되지 않았어도)
- **S (자가검증하는)**
테스트는 부울 값으로 결과를 내야 한다. 성공 / 실패로만 나뉘어야 한다.
테스트가 스스로 성공과 실패를 가늠해야 한다.
- **T (적시에)**
단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현해야 한다.

<br>

다음 공부할건 TDD에 관해서 인가..
