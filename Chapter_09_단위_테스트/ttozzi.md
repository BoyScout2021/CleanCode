# 단위 테스트

## TDD의 법칙

- 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
- 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
- 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

테스트 코드와 실제 코드가 함께 나옴

모든 로직에 대한 테스트 케이스가 나옴

### 깨끗한 테스트 코드 유지하기

테스트 코드는 실제 코드와 동일한 품질 기준을 적용하지 않아도 되는가?

실제 코드에 변경이 생기면, 테스트 코드도 수정해야하는데, 테스트 코드가 복잡할수록 테스트 코드를 추가하는데도 오랜 시간이 걸림

테스트 코드도 꾸준히 유지보수해야하는 코드이기에 실제 코드 못지 않게 깔끔하게 짜야 함

### 테스트는 유연성, 유지보수성, 재사용성을 제공한다

단위 테스트는 코드에 유연성, 유지보수성, 재사용성을 제공한다.

테스트 케이스가 없으면 개발자는 기존 코드의 변경을 주저하게 된다.

실제 코드를 점검하는 자동화된 단위 테스트는 설계와 아키텍처를 최대한 깨끗하게 보존하는 열쇠

### 깨끗한 테스트 코드

테스트 코드에서 가장 중요한 것은 가독성

- BUILD-OPERATE-CHECK 패턴
  - 테스트 자료를 만듦
  - 테스트 자료를 조작
  - 조작한 결과가 올바른지 확인

### 도메인 특화 테스트 언어

### 이중 표준

테스트 코드는 간결하고, 표현력이 풍부해야 하지만, 실제 코드만큼 효율적인 필요는 없음

메모리, CPU 효율과 관련있는 기준은 실제 코드에서는 굉장히 중요하지만, 테스트 코드에서는 전혀 신경 쓸 필요가 없음

실제 코드와 테스트 코드를 검수하는 기준을 다르게 둬야 함

### 테스트 당 assert 하나

테스트의 성공, 실패 여부를 검증하는 assert문을 한개만 사용하면 코드를 이해하기 쉬움

assert를 한개만 사용하기 위해선 어쩔 수 없이 중복되는 Given, When 설정 코드가 생길 수 있음

중복된 부분은 따로 메서드로 분리하거나, Quick(Given/When/Then 양식의 편리한 테스트 코드 작성을 제공하는 프레임워크)을 활용하면 깔끔하게 작성 가능

assert를 하나만 사용하는 건 정말 좋지만, 상황에 따라 여러개의 assert를 사용하는 경우가 있을 수도 있음

### 테스트 당 개념 하나

테스트 함수마다 한 개념만 테스트해야 함

테스트 케이스의 assert문 갯수를 줄이는 걸 신경쓰면, 자연스럽게 하나의 개념만 테스트하게 됨

### FIRST

- **F**ast

  단위 테스트는 빨라야 함. 테스트 단계에서 오랜 시간이 걸린다면, 개발/배포 시간이 느려짐. 느린 테스트의 주요 원인 중 하나는 데이터베이스, 파일 및 네트워크 호출과 같은 외부 요소와의 종속성. 빠른 단위 테스트를 작성하기 위해서는 이러한 외부 요소를 모의 객체로 대체하여 모의 테스트를 작성해야 함.

- **I**ndependent

  다른 테스트 케이스에 의존하는 테스트 케이스를 작성하면 안됨. 어떠한 테스트 케이스도 이전 테스트의 상태에 의존해서는 안됨. 각 테스트를 개별적으로 실행할 수 있어야 함. 독립적인 테스트가 가능해지면 무엇이, 어디서 잘못되었는지 확인할 수 있어 디버깅이 수월해짐.

- **R**epeatable

  어떤 환경에서 몇 번을 실행하든 테스트는 항상 같은 결과를 반환해야 함. 네트워크나 데이터베이스와 같은 외부 요소에 의해 결과가 바뀌는 일이 없어야 함. 어쩔 수 없이 외부 요소와 의존성을 가지는 경우, 외부 요소를 모의 객체로 대체하여 테스트를 작성하는 등의 방법을 사용.

- **S**elf-validating

  테스트는 자체적으로 성공, 실패를 결정할 수 있어야 함. 테스트 결과에 대한 해석이 필요 없어야 함. 단적인 예로 print와 같은 로그 출력을 테스트에 포함하는 경우가 있음. 출력된 로그를 개발자가 한 번 더 해석해야 하므로 테스트코드 작성의 의미가 없어짐.

- **T**imely

  테스트는 적절한 시기에 작성되어야 함. 프로덕션 코드를 작성하기 전에 테스트 코드를 작성하는 것이 좋음. 테스트 코드를 먼저 작성하면, 자연스럽게 코드를 테스트하기 좋은 구조로 설계하게 됨. 프로덕션 코드를 작성한 후 테스트 코드를 작성하게 되면, 테스트 코드를 작성하기 위해 프로덕션 코드의 구조를 수정해야 하는 상황이 생길 수 있음.



## 결론

테스트 코드도 깨끗하게 유지하자!!!

